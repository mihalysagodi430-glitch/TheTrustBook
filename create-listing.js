import { createClient } from '@supabase/supabase-js'; const supabase = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SERVICE_ROLE); export default async function handler(req, res){ if(req.method!=='POST') return res.status(405).end(); const body = req.body; try{ const { data, error } = await supabase.from('listings').insert([{ title: body.title, description: body.description, price: body.price, price_cents: Math.round(body.price*100), file_url: body.file_url, author_id: body.author_id, seller_stripe_account_id: body.seller_stripe_account_id }]).select().single(); if(error) return res.status(400).json({ error: error.message }); res.json({ ok:true, listing: data }); }catch(e){ res.status(500).json({ error: e.message }); } }