import { createClient } from '@supabase/supabase-js'; const supabase = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SERVICE_ROLE); export default async function handler(req, res){ if(req.method!=='POST') return res.status(405).end(); const { name, desc, created_by, is_public } = req.body; try{ const { data, error } = await supabase.from('groups').insert([{ name, description: desc, created_by, is_public: is_public===undefined?true:is_public }]).select().single(); if(error) return res.status(400).json({ error: error.message }); await supabase.from('group_members').insert([{ group_id: data.id, user_id: created_by, role: 'admin' }]); res.json({ ok:true, group: data }); }catch(e){ res.status(500).json({ error: e.message }); } }